import{m as k}from"./assets/module.esm-94724523.js";import{t as u,b as a}from"./assets/buffer-5b356251.js";document.addEventListener("alpine:init",()=>{k.data("webAuthnRegister",function(){const{attestationObjectInput:g,authenticatorLabelInput:A,clientDataJSONInput:I,errorInput:w,publicKeyCredentialIdInput:C,registerForm:s,transportsInput:K}=this.$refs,{attestationConveyancePreference:c,authenticatorAttachment:l,challenge:v,createTimeout:p,excludeCredentialIds:S,requireResidentKey:d,rpEntityName:P,rpId:R,signatureAlgorithms:x,unsupportedBrowserText:E,userId:L,userVerificationRequirement:f,username:y}=this.$store.webAuthnRegister,q=t=>{const e=[];return t===""?(e.push({alg:-7,type:"public-key"}),e):(t.split(",").forEach(i=>{e.push({alg:parseInt(i),type:"public-key"})}),e)},N=t=>{const e=[];return t===""||t.split(",").forEach(i=>{e.push({id:u(a.parse(i,{loose:!0})),type:"public-key"})}),e},O=t=>{if(t===""||t.constructor!==Array)return"";let e="";return t.forEach(n=>{e+=n+","}),e.slice(0,-1)};return{registerSecurityKey:()=>{if(!window.PublicKeyCredential){w.value=E,s.submit();return}const t={challenge:u(a.parse(v,{loose:!0})),pubKeyCredParams:q(x),rp:{id:R,name:P},user:{displayName:y,id:u(a.parse(L,{loose:!0})),name:y}};c!=="not specified"&&(t.attestation=c);const e={};let n=!1;l!=="not specified"&&(e.authenticatorAttachment=l,n=!0),d!=="not specified"&&(d==="Yes"?e.requireResidentKey=!0:e.requireResidentKey=!1,n=!0),f!=="not specified"&&(e.userVerification=f,n=!0),n&&(t.authenticatorSelection=e);const i=N(S);i.length>0&&(t.excludeCredentials=i),parseInt(p)!==0&&(t.timeout=parseInt(p)*1e3),navigator.credentials.create({publicKey:t}).then(r=>{if(r instanceof PublicKeyCredential&&r.response instanceof AuthenticatorAttestationResponse){const{getTransports:h}=r.response;window.result=r;const T=r.rawId;if(g.value=a.stringify(new Uint8Array(r.response.attestationObject),{pad:!1}),I.value=a.stringify(new Uint8Array(r.response.clientDataJSON),{pad:!1}),C.value=a.stringify(new Uint8Array(T),{pad:!1}),typeof h=="function"){const m=h();m&&(K.value=O(m))}else console.log("Your browser is not able to recognize supported transport media for the authenticator.");const b="WebAuthn Authenticator (Default Label)";let o=window.prompt("Please input your registered authenticator's label",b);o===null&&(o=b),A.value=o,s.submit()}}).catch(function(r){r.value=r,s.submit()})}}})});
